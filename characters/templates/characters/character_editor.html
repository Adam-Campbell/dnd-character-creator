{% extends "base.html" %}
{% load static %}

{% block title %}Create A Character | DnD Character Creator{% endblock %}

{% block extra_head_content %}
<script>
    window.editorData = {{  editor_data|safe }};
</script>
{% endblock %}

{% block content %}
<div class="container pt-4">
    <form method="post" id="character-creator-form" data-data="characterGenerator">
        <template data-if="isLoading">
            <div>Loading...</div>
        </template>
        <template data-if="!isLoading">
            <div class="d-flex flex-column">

                <!-- Desktop navigation -->
                <div class="btn-group editor-desktop-nav" role="group" aria-label="Editor page selection">
                    <button data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'race'}"
                        type="button" data-on:click="() => setPage('race')">Race</button>
                    <button data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'class'}"
                        type="button" data-on:click="() => setPage('class')">Class</button>
                    <button data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'abilityPoints'}"
                        type="button" data-on:click="() => setPage('abilityPoints')">Ability Points</button>
                    <template data-if="isCaster">
                        <button
                            data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'spells'}"
                            type="button" data-on:click="() => setPage('spells')">Spells</button>
                    </template>
                    <button
                        data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'background'}"
                        type="button" data-on:click="() => setPage('background')">Background</button>
                    <button
                        data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'appearance'}"
                        type="button" data-on:click="() => setPage('appearance')">Appearance</button>
                    <button data-bind:disabled="!isComplete" data-bind:class="{ 'btn': true, 'btn-primary': true, 'active': currentPage === 'summary'}"
                        type="button" data-on:click="() => setPage('summary')">Summary</button>
                </div>

                <!-- Mobile navigation -->
                <div class="dropdown editor-mobile-nav  align-self-end">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="editorDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Select page
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="editorDropdown">
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'race' }"
                                type="button" data-on:click="() => setPage('race')">Race</button></li>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'class' }"
                                type="button" data-on:click="() => setPage('class')">Class</button></li>
                        <li><button
                                data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'abilityPoints' }"
                                type="button" data-on:click="() => setPage('abilityPoints')">Ability Points</button>
                        </li>
                        <template data-if="isCaster">
                            <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'spells' }"
                                    type="button" data-on:click="() => setPage('spells')">Spells</button></li>
                        </template>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'background' }"
                                type="button" data-on:click="() => setPage('background')">Background</button></li>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'appearance' }"
                                type="button" data-on:click="() => setPage('appearance')">Appearance</button></li>
                        <li><button data-bind:disabled="!isComplete" data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'summary' }"
                                type="button" data-on:click="() => setPage('summary')">Summary</button></li>
                </div>

                <!-- Markup for race selection -->
                <template data-if="currentPage === 'race'">
                    <div class="d-flex flex-column mt-4">
                        <!-- Race Select box -->
                        <div class="d-flex align-items-center align-self-start">
                            <label class="form-label text-nowrap me-2 mb-0" for="race-select">Choose a race:</label>
                            <select class="form-select" id="race-select" data-model="character.race"
                                data-on:change="resetStateOnRaceChange">
                                <template data-for="race in staticData.races">
                                    <option data-bind:value="race.id" data-text="race.name"
                                        data-bind:selected="character.race === race.id ? true : false">.</option>
                                </template>
                            </select>
                        </div>
                        <!-- Race info -->
                        <div class="row my-4">
                            <div class="col-12 col-md-8 col-lg-9">
                                <h1 class="heading-font" data-text="chosenRace.name"></h1>
                                <p data-text="chosenRace.description"></p>
                            </div>
                            <div class="col-12 col-md-4 col-lg-3">
                                <span class="badge text-bg-dark me-1" data-text="`Size: ${chosenRace.size}`"></span>
                                <span class="badge text-bg-dark me-1"
                                    data-text="`Speed: ${chosenRace.speed} feet`"></span>
                                <template data-if="chosenRace.darkvision === true">
                                    <span class="badge text-bg-dark me-1">Darkvision</span>
                                </template>
                                <template
                                    data-for="abilityBonus in chosenRace.abilityBonuses.filter(abilityBonus => abilityBonus.bonus !== 0)">
                                    <span class="badge text-bg-dark me-1"
                                        data-text="`${abilityBonus.ability.name} +${abilityBonus.bonus}`"></span>
                                </template>
                                <template data-for="weapon in chosenRace.weaponProficiencies">
                                    <span class="badge text-bg-dark" data-text="`${weapon.name} proficiency`"></span>
                                </template>
                            </div>
                        </div>
                        <!-- Additional race properties -->
                        <template data-if="chosenRace.additionalProperties.length > 0">
                            <div class="mb-4">
                                <h2 class="h3 heading-font">Additional Properties</h2>
                                <div class="accordion" id="additional-race-properties">
                                    <template data-for="(property, index) in chosenRace.additionalProperties">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bind:data-bs-toggle="'collapse'"
                                                    data-bind:data-bs-target="'#collapse' + index" aria-expanded="false"
                                                    data-bind:aria-controls="'collapse' + index"
                                                    data-text="property.name">            
                                                </button>
                                            </h2>
                                            <div data-bind:id="'collapse' + index" class="accordion-collapse collapse"
                                                data-bind:data-bs-parent="'#additional-race-properties'">
                                                <div class="accordion-body" data-text="property.description"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>

                <!-- Markup for class selection -->
                <template data-if="currentPage === 'class'">
                    <div class="d-flex flex-column mt-4">
                        <!-- Class Select box -->
                        <div class="d-flex align-items-center align-self-start">
                            <label class="form-label text-nowrap me-2 mb-0" for="class-select">Choose a class:</label>
                            <select class="form-select" id="class-select" data-model="character.class" data-on:change="resetStateOnClassChange">
                                <template data-for="cls in staticData.classes">
                                    <option data-bind:value="cls.id" data-text="cls.name"
                                        data-bind:selected="character.class === cls.id ? true : false">.</option>
                                </template>
                            </select>
                        </div>

                        <div class="row my-4">
                            <!-- Class info -->
                            <div class="col-12 col-md-8 col-lg-9 mb-4">
                                <h1 class="heading-font" data-text="chosenClass.name"></h1>
                                <span class="badge text-bg-dark" data-text="`Hit Die: ${chosenClass.hitDie}`"></span>
                                <p data-text="chosenClass.description"></p>
                            </div>
                            <!-- Class skills -->
                            <div class="col-12 col-md-4 col-lg-3 mb-4">
                                <h2 class="h3 heading-font">Skills</h2>
                                <p data-text="`Choose ${computedNumberOfSkillProficiencies} of the following skills to be proficient in:`"></p>
                                <ul class="list-group">
                                    <!-- Use index to apply rounded-top because Alpine doesn't play nicely with Bootstrap -->
                                    <template data-for="(skill, index) in chosenClass.proficiencies.skills.from">
                                        <li data-bind:class="`list-group-item ${index === 0 ? 'rounded-top' : ''}`">
                                            <input type="checkbox" data-bind:id="skill.id" data-bind:checked="character.classSkillChoices.includes(skill.id)"
                                                data-on:change="toggleSkillProficiency(skill.id)"
                                                data-bind:disabled="Boolean(character.classSkillChoices.length >= computedNumberOfSkillProficiencies &&  !character.classSkillChoices.includes(skill.id))">
                                            <label data-bind:for="skill.id" data-text="skill.name"></label>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                            <!-- Class proficiencies -->
                            <div class="col-12 col-lg-9 mb-4">
                                <h2 class="h3 heading-font">Proficiencies</h2>
                                <div class="border border-light-subtle p-3 bg-white rounded">
                                    <table class="table">
                                        <tbody>
                                            <tr data-show="chosenClass.proficiencies.armor.length > 0">
                                                <th class="align-middle">Armor Proficiencies</th>
                                                <td class="align-middle">
                                                    <template data-for="armorType in chosenClass.proficiencies.armor">
                                                        <span class="badge text-bg-dark me-1" data-text="armorType.name"></span>
                                                    </template>
                                                </td>
                                            </tr>
                                            <tr data-show="chosenClass.proficiencies.weapons.length > 0">
                                                <th class="align-middle">Weapon Proficiencies</th>
                                                <td class="align-middle">
                                                    <template data-for="weapon in chosenClass.proficiencies.weapons">
                                                        <span class="badge text-bg-dark me-1" data-text="weapon.name"></span>
                                                    </template>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="align-middle">Saving Throw Proficiencies</th>
                                                <td class="align-middle">
                                                    <template data-for="savingThrow in chosenClass.proficiencies.savingThrows">
                                                        <span class="badge text-bg-dark me-1" data-text="savingThrow.name"></span>
                                                    </template>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-12 col-lg-3 mb-4">
                                <!-- Class equipment -->
                                <h2 class="h3 heading-font">Equipment</h2>
                                <ul class="list-group">
                                    <!-- Use index to apply rounded-top because Alpine doesn't play nicely with Bootstrap -->
                                    <template data-for="(equipment, index) in chosenClass.equipment">
                                        <li data-bind:class="`d-flex justify-content-between list-group-item ${index === 0 ? 'rounded-top' : ''}`">
                                            <span data-text="equipment.item.name"></span>
                                            <span class="badge text-bg-light" data-text="`× ${equipment.quantity}`"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <template data-if="chosenClass.additionalProperties.length > 0">
                                <!-- Additional class properties -->
                                <div class="mb-4">
                                    <h2 class="h3 heading-font">Additional Properties</h2>
                                    <div class="accordion" id="additional-class-properties">
                                        <template data-for="(property, index) in chosenClass.additionalProperties">
                                            <div class="accordion-item">
                                                <h3 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bind:data-bs-toggle="'collapse'"
                                                        data-bind:data-bs-target="'#collapse' + index" aria-expanded="false"
                                                        data-bind:aria-controls="'collapse' + index"
                                                        data-text="property.name">            
                                                    </button>
                                                </h3>
                                                <div data-bind:id="'collapse' + index" class="accordion-collapse collapse"
                                                    data-bind:data-bs-parent="'#additional-class-properties'">
                                                    <div class="accordion-body" data-text="property.description"></div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                                
                        </div>

                    </div>
                </template>

                <!-- Markup for ability points selection -->
                <template data-if="currentPage === 'abilityPoints'">
                    <div class="row" data-data="{ uuids: ['0caab33e-f424-4a44-94cd-0c6951e5bdfe', 'fd107c7f-4536-4b36-bf43-e49d92a3c4c2', 'b9b14f85-78db-49ea-b07b-b8bdd7a40046', '44fbcb3c-d548-4a3c-aa85-4c55e05aabed', '468b3218-340b-4263-9450-dc72e6750f16', 'b15c2aa9-87e7-408d-89a7-3bbd64d981a9'] }">
                        <!-- Explanation -->
                        <div class="col-12 my-4">
                            <h1 class="heading-font">Ability points</h1>
                            <p>Ability points are assigned using the Standard Array - a method that offers a balanced way to assign your ability scores without the randomness of rolling dice. You are given a predefined set of numbers: 15, 14, 13, 12, 10, and 8. You can assign each of these values to one of your six ability scores—Strength, Dexterity, Constitution, Intelligence, Wisdom, and Charisma—based on what best suits your character's strengths and weaknesses.</p>
                            <p>Your character's primary ability is <span class="badge text-bg-dark" data-text="chosenClass.primaryAbility.name"></span></p>
                        </div>
                        <!-- Ability points Select boxes -->
                        <template data-for="(uuid, index) in uuids">
                            <div class="col-12 col-sm-6 col-lg-4 col-xxl-2">
                                <div class="d-flex align-items-center mb-md-2">
                                    <label class="fw-bold form-label me-2 mb-0" :for="`ability-select-${index}`" data-text="getAbilityData(uuid).name"></label>
                                    <select class="form-select" :id="`abiliity-select-${index}`" data-model.number="character.abilityPoints[index].value">
                                        <template
                                            data-for="pointOption in computeAbilityPointOptions(uuid)">
                                            <option data-bind:value="pointOption"
                                                data-bind:selected="character.abilityPoints[index].value === pointOption ? true : false"
                                                data-text="pointOption">
                                            </option>
                                        </template>
                                    </select>
                                </div>
                                <p class="d-md-none" data-text="getAbilityData(uuid).description"></p>
                            </div>
                        </template>
                        <div class="col-12 d-flex flex-column flex-sm-row mb-4">
                            <button class="btn btn-primary mb-2" type="button" data-on:click="resetAbilityPoints">Reset ability points</button>
                            <button class="btn btn-primary mb-2 ms-sm-2" type="button" data-on:click="setAbilityPointsToChosenClassDefaults">Use class defaults</button>
                        </div>
                        <!-- Ability points display -->
                        <template data-for="(uuid, index) in uuids">
                            <div class="d-flex mb-4 col-12 col-md-6 col-lg-4">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center justify-content-between justify-content-md-around">
                                            <p class="display-1 editor-ability-card-number" data-text="getAdjustedAbilityScore(uuid)"></p>
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Base Score: <span class="ms-1 badge bg-light text-dark" data-text="getAbilityBaseScore(uuid)"></span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Racial Bonus: <span class="ms-1 badge bg-light text-dark" data-text="getRacialAbilityBonus(uuid)"></span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Modifier: <span class="ms-1 badge bg-light text-dark" data-text="getAbilityModifier(uuid)"></span>
                                                </li>
                                            </ul>     
                                        </div>
                                        <h3 class="h5 card-title" data-text="getAbilityData(uuid).name"></h3>
                                        <p class="card-text" data-text="getAbilityData(uuid).description"></p>
                                    </div>    
                                </div>
                            </div>
                        </template>
                    </div> 
                </template>

                <!-- Markup for spells selection -->
                <template data-if="currentPage === 'spells'">
                    <div class="row mt-4">
                        <!-- Cantrip selection -->
                        <div class="col-12 col-lg-6 mb-4">
                            <h2 class="h3 heading-font">Cantrips</h2>
                            <p data-text="`${character.classCantripChoices.length} of ${chosenClass.spellcasting.cantrips.choose} cantrips chosen`"></p>
                            <div class="accordion" id="cantrip-details">
                                <template data-for="(cantrip, index) in chosenClass.spellcasting.cantrips.from">
                                    <div class="accordion-item">
                                        <h3 class="accordion-header">
                                            <button class="accordion-button collapsed" 
                                                type="button" data-bind:data-bs-toggle="'collapse'"
                                                data-bind:data-custom-selected-item="character.classCantripChoices.includes(cantrip.id)"
                                                data-bind:data-bs-target="'#cantrip-collapse' + index" aria-expanded="false"
                                                data-bind:aria-controls="'cantrip-collapse' + index"
                                                data-text="cantrip.name">            
                                            </button>
                                        </h3>
                                        <div data-bind:id="'cantrip-collapse' + index" class="accordion-collapse collapse"
                                            data-bind:data-bs-parent="'#cantrip-details'">
                                            <div class="accordion-body">
                                                <p data-html="formatLineBreaks(cantrip.description)"></p>
                                                <div>
                                                    <span class="badge text-bg-dark" data-text="`Range: ${cantrip.range}`"></span>
                                                    <span class="badge text-bg-dark" data-text="`Casting time: ${cantrip.castingTime}`"></span>
                                                    <span class="badge text-bg-dark" data-text="`Duration: ${cantrip.duration}`"></span>
                                                    <template data-if="cantrip.concentration">
                                                        <span class="badge text-bg-dark">Requires concentration</span>
                                                    </template>
                                                </div>
                                                <template data-if="character.classCantripChoices.includes(cantrip.id)">
                                                    <button class="btn btn-danger mt-1" type="button" data-on:click="() => removeCantrip(cantrip.id)">Remove
                                                        Cantrip</button>
                                                </template>
                                                <template data-if="!character.classCantripChoices.includes(cantrip.id)">
                                                    <button
                                                        class="btn btn-primary mt-1" 
                                                        type="button"
                                                        data-bind:disabled="character.classCantripChoices.length >= chosenClass.spellcasting.cantrips.choose"
                                                        data-on:click="() => addCantrip(cantrip.id)">
                                                        Add Cantrip
                                                    </button>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        <!-- Spell selection -->
                        <div class="col-12 col-lg-6 mb-4">
                            <h2 class="h3 heading-font">Spells</h2>
                            <p data-text="`${character.classSpellChoices.length} of ${chosenClass.spellcasting.spells.choose} spells chosen`"></p>
                            <div class="accordion" id="spell-details">
                                <template data-for="(spell, index) in chosenClass.spellcasting.spells.from">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" 
                                                type="button" data-bind:data-bs-toggle="'collapse'"
                                                data-bind:data-custom-selected-item="character.classSpellChoices.includes(spell.id)"
                                                data-bind:data-bs-target="'#spell-collapse' + index" aria-expanded="false"
                                                data-bind:aria-controls="'spell-collapse' + index"
                                                data-text="spell.name">            
                                            </button>
                                        </h2>
                                        <div data-bind:id="'spell-collapse' + index" class="accordion-collapse collapse"
                                            data-bind:data-bs-parent="'#spell-details'">
                                            <div class="accordion-body">
                                                <p data-html="formatLineBreaks(spell.description)"></p>
                                                <div>
                                                    <span class="badge text-bg-dark" data-text="`Range: ${spell.range}`"></span>
                                                    <span class="badge text-bg-dark" data-text="`Casting time: ${spell.castingTime}`"></span>
                                                    <span class="badge text-bg-dark" data-text="`Duration: ${spell.duration}`"></span>
                                                    <template data-if="spell.concentration">
                                                        <span class="badge text-bg-dark">Requires concentration</span>
                                                    </template>
                                                </div>
                                                <template data-if="character.classSpellChoices.includes(spell.id)">
                                                    <button class="btn btn-danger mt-1" type="button" data-on:click="() => removeSpell(spell.id)">Remove
                                                        Spell</button>
                                                </template>
                                                <template data-if="!character.classSpellChoices.includes(spell.id)">
                                                    <button
                                                        class="btn btn-primary mt-1" 
                                                        type="button"
                                                        data-bind:disabled="character.classSpellChoices.length >= chosenClass.spellcasting.spells.choose"
                                                        data-on:click="() => addSpell(spell.id)">
                                                        Add Spell
                                                    </button>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>  
                </template>


                <!-- Markup for background selection -->
                <template data-if="currentPage === 'background'">
                    <div class="row my-4">
                        <h1 class="heading-font">Background</h1>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-name">Name</label>
                            <input class="form-control" id="character-name" type="text" data-model="character.name" placeholder="Enter name" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-age">Age</label>
                            <input class="form-control" id="character-age" type="number" min="0" data-model="character.age" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-gender">Gender</label>
                            <input class="form-control" id="character-gender" type="text" data-model="character.gender" placeholder="Choose gender" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-alignment">Alignment</label>
                            <select class="form-select" id="character-alignment" data-model="character.alignment">
                                <option value="Lawful Good"
                                    data-bind:selected="character.alignment === 'Lawful Good' ? true : false">Lawful Good
                                </option>
                                <option value="Neutral Good"
                                    data-bind:selected="character.alignment === 'Neutral Good' ? true : false">Neutral Good
                                </option>
                                <option value="Chaotic Good"
                                    data-bind:selected="character.alignment === 'Chaotic Good' ? true : false">Chaotic Good
                                </option>
                                <option value="Lawful Neutral"
                                    data-bind:selected="character.alignment === 'Lawful Neutral' ? true : false">Lawful
                                    Neutral</option>
                                <option value="True Neutral"
                                    data-bind:selected="character.alignment === 'True Neutral' ? true : false">True Neutral
                                </option>
                                <option value="Chaotic Neutral"
                                    data-bind:selected="character.alignment === 'Chaotic Neutral' ? true : false">Chaotic
                                    Neutral</option>
                                <option value="Lawful Evil"
                                    data-bind:selected="character.alignment === 'Lawful Evil' ? true : false">Lawful Evil
                                </option>
                                <option value="Neutral Evil"
                                    data-bind:selected="character.alignment === 'Neutral Evil' ? true : false">Neutral Evil
                                </option>
                                <option value="Chaotic Evil"
                                    data-bind:selected="character.alignment === 'Chaotic Evil' ? true : false">Chaotic Evil
                                </option>
                            </select>
                        </div>
                        <div class="col-12 col-lg-8 col-xl-12 mb-4 ">
                            <label class="form-label me-2" for="character-background">Background</label>
                            <textarea class="form-control" id="character-background" data-model="character.background"
                                placeholder="Enter background" rows="4"></textarea>
                        </div>
                        <!-- Traits -->
                        <div class="col-12 col-md-6 mb-4" data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div class="card">
                                <div class="card-body">
                                    <label class="form-label" for="character-traits">Traits</label>
                                    <div class="input-group mb-3">
                                        <input class="form-control" id="character-traits" type="text" data-model="temp"
                                            data-on:keydown.enter="() => { character.traits.push(temp); clear() }" />
                                        <button class="btn btn-outline-primary" type="button"
                                            data-on:click="() => { character.traits.push(temp); clear() }">Add</button>
                                    </div>
                                    <template data-if="character.traits.length > 0">
                                        <ul class="list-group list-group-flush">
                                            <template data-for="(trait, index) in character.traits">
                                                <li data-bind:key="trait" class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span data-text="trait"></span>
                                                    <button class="btn btn-danger" type="button" aria-label="Delete trait"
                                                        data-on:click="() => character.traits.splice(index, 1)">
                                                        <i class="fa-solid fa-trash-can"></i>
                                                    </button>
                                                </li>
                                            </template>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <!-- Ideals -->
                        <div class="col-12 col-md-6 mb-4" data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div class="card">
                                <div class="card-body">
                                    <label class="form-label" for="character-ideals">Ideals</label>
                                    <div class="input-group mb-3">
                                        <input class="form-control" id="character-ideals" type="text" data-model="temp"
                                            data-on:keydown.enter="() => { character.ideals.push(temp); clear() }" />
                                        <button class="btn btn-outline-primary" type="button"
                                            data-on:click="() => { character.ideals.push(temp); clear() }">Add</button>
                                    </div>
                                    <template data-if="character.ideals.length > 0">
                                        <ul class="list-group list-group-flush">
                                            <template data-for="(ideal, index) in character.ideals">
                                                <li data-bind:key="ideal" class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span data-text="ideal"></span>
                                                    <button class="btn btn-danger" type="button" aria-label="Delete ideal"
                                                        data-on:click="() => character.ideals.splice(index, 1)">
                                                        <i class="fa-solid fa-trash-can"></i>
                                                    </button>
                                                </li>
                                            </template>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <!-- Bonds -->
                        <div class="col-12 col-md-6 mb-4" data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div class="card">
                                <div class="card-body">
                                    <label class="form-label" for="character-bonds">Bonds</label>
                                    <div class="input-group mb-3">
                                        <input class="form-control" id="character-bonds" type="text" data-model="temp"
                                            data-on:keydown.enter="() => { character.bonds.push(temp); clear() }" />
                                        <button class="btn btn-outline-primary" type="button"
                                            data-on:click="() => { character.bonds.push(temp); clear() }">Add</button>
                                    </div>
                                    <template data-if="character.bonds.length > 0">
                                        <ul class="list-group list-group-flush">
                                            <template data-for="(bond, index) in character.bonds">
                                                <li data-bind:key="bond" class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span data-text="bond"></span>
                                                    <button class="btn btn-danger" type="button" aria-label="Delete bond"
                                                        data-on:click="() => character.bonds.splice(index, 1)">
                                                        <i class="fa-solid fa-trash-can"></i>
                                                    </button>
                                                </li>
                                            </template>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <!-- Flaws -->
                        <div class="col-12 col-md-6 mb-4" data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div class="card">
                                <div class="card-body">
                                    <label class="form-label" for="character-flaws">Flaws</label>
                                    <div class="input-group mb-3">
                                        <input class="form-control" id="character-flaws" type="text" data-model="temp"
                                            data-on:keydown.enter="() => { character.flaws.push(temp); clear() }" />
                                        <button class="btn btn-outline-primary" type="button"
                                            data-on:click="() => { character.flaws.push(temp); clear() }">Add</button>
                                    </div>
                                    <template data-if="character.flaws.length > 0">
                                        <ul class="list-group list-group-flush">
                                            <template data-for="(flaw, index) in character.flaws">
                                                <li data-bind:key="flaw" class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span data-text="flaw"></span>
                                                    <button class="btn btn-danger" type="button" aria-label="Delete flaw"
                                                        data-on:click="() => character.flaws.splice(index, 1)">
                                                        <i class="fa-solid fa-trash-can"></i>
                                                    </button>
                                                </li>
                                            </template>
                                    </template>
                                </div>
                            </div>
                        </div>

                    </div>
                </template>

                <!-- Markup for appearance selection -->
                <template data-if="currentPage === 'appearance'">
                    <div class="row my-4">
                        <h1 class="heading-font">Appearance</h1>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-height">Height</label>
                            <input class="form-control" id="character-height" type="text" data-model="character.height" placeholder="Enter height" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-build">Build</label>
                            <input class="form-control" id="character-build" type="text" data-model="character.build" placeholder="Enter build" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-skin-tone">Skin Tone</label>
                            <input class="form-control" id="character-skin-tone" type="text" data-model="character.skinTone" placeholder="Enter skin tone" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-eye-color">Eye Color</label>
                            <input class="form-control" id="character-eye-color" type="text" data-model="character.eyeColor" placeholder="Enter eye color" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-eye-shape">Eye shape</label>
                            <select class="form-select" data-data="{ options: ['Almond', 'Round', 'Hooded', 'Monolid', 'Upturned', 'Downturned'] }"
                                    data-model="character.eyeShape" id="character-eye-shape">
                                    <template data-for="option in options">
                                        <option data-bind:value="option"
                                            data-bind:selected="Boolean(character.eyeShape === option)"
                                            data-text="option"></option>
                                    </template>
                            </select>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-distinguishing-features">Distinguishing Features</label>
                            <input class="form-control" id="character-distinguishing-features" type="text" data-model="character.distinguishingFeatures" placeholder="Enter distinguishing features" />
                        </div>
                        <h2 class="h3 heading-font">Hair</h2>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-hair-color">Hair Color</label>
                            <input class="form-control" id="character-hair-color" type="text" data-model="character.hairColor" placeholder="Enter hair color" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-hair-style">Hair Style</label>
                            <input class="form-control" id="character-hair-style" type="text" data-model="character.hairStyle" placeholder="Enter hair style" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-hair-length">Hair Length</label>
                            <select class="form-select" data-data="{ options: ['Bald', 'Cropped', 'Short', 'Medium', 'Long'] }"
                                    data-model="character.hairLength" id="character-hair-length">
                                    <template data-for="option in options">
                                        <option data-bind:value="option"
                                            data-bind:selected="Boolean(character.hairLength === option)"
                                            data-text="option"></option>
                                    </template>
                            </select>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-hair-type">Hair Type</label>
                            <select class="form-select" data-data="{ options: ['Straight', 'Wavy', 'Curly', 'Coily'] }"
                                    data-model="character.hairType" id="character-hair-type">
                                    <template data-for="option in options">
                                        <option data-bind:value="option"
                                            data-bind:selected="Boolean(character.hairType === option)"
                                            data-text="option"></option>
                                    </template>
                            </select>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-facial-hair-style">Facial Hair Style</label>
                            <select class="form-select" data-model="character.facialHairStyle" 
                                    id="character-facial-hair-style" data-on:change="adjustFacialHairLength"
                                    data-data="{ options: ['None', 'Stubble', 'Full Beard', 'Goatee', 'Moustache', 'Sideburns', 'Soul Patch', 'Mutton Chops'] }">
                                    <template data-for="option in options">
                                        <option data-bind:value="option"
                                            data-bind:selected="Boolean(character.hairType === option)"
                                            data-text="option"></option>
                                    </template>
                            </select>
                        </div>
                        <template data-if="character.facialHairStyle !== 'None' && character.facialHairStyle !== 'Stubble'">  
                            <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                                <label class="form-label me-2" for="character-facial-hair-length">Facial Hair Length</label>
                                <select class="form-select" data-data="{ options: ['Short', 'Medium', 'Long'] }"
                                        data-model="character.facialHairLength" id="character-facial-hair-length">
                                        <template data-for="option in options">
                                            <option data-bind:value="option"
                                                data-bind:selected="Boolean(character.hairType === option)"
                                                data-text="option"></option>
                                        </template>
                                </select>
                            </div>
                        </template>
                        <h2 class="h3 heading-font">Clothing</h2>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-clothing-style">Clothing Style</label>
                            <input class="form-control" id="character-clothing-style" type="text" data-model="character.clothingStyle" placeholder="Enter clothing style" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-clothing-colors">Clothing Colors</label>
                            <input class="form-control" id="character-clothing-colors" type="text" data-model="character.clothingColors" placeholder="Enter clothing colors" />
                        </div>
                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                            <label class="form-label me-2" for="character-clothing-accessories">Clothing Accessories</label>
                            <input class="form-control" id="character-clothing-accessories" type="text" data-model="character.clothingAccessories" placeholder="Enter clothing accessories" />
                        </div>
                    </div>
                </template>

                <!-- Markup for summary -->
                <template data-if="currentPage === 'summary'">
                    <div class="d-flex justify-content-center">
                        <div class="card editor-summary-card mt-4">
                            <div class="card-body d-flex flex-column align-items-start">
                                <h1 class="card-title" data-text="character.name"></h1>
                                <p class="card-subtitle text-body-secondary mb-2" data-text="`${chosenRace.name} ${chosenClass.name}`"></p>
                                <span class="badge text-bg-dark" data-text="character.alignment"></span>
                                <p class="card-text mt-3" data-text="character.background"></p>
                                <button class="btn btn-outline-primary" type="button" data-on:click="handleSubmit">Save</button>
                            </div>
                        </div>
                    </div>
                    
                </template>
            </div>
        </template>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script type="module" src="{% static 'js/main.js' %}"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}