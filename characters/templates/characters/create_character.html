{% extends "base.html" %}
{% load static %}

{% block title %}Create A Character | DnD Character Creator{% endblock %}

{% block content %}
<div class="container pt-4">
    <form method="post" id="character-creator-form" data-data="characterGenerator">
        <template data-if="isLoading">
            <div>Loading...</div>
        </template>
        <template data-if="!isLoading">
            <div class="d-flex flex-column">
                <div class="btn-group editor-desktop-nav" role="group" aria-label="Editor page selection">
                    <button data-bind:class="currentPage === 'race' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                        type="button" data-on:click="() => setPage('race')">Race</button>
                    <button data-bind:class="currentPage === 'class' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                        type="button" data-on:click="() => setPage('class')">Class</button>
                    <button
                        data-bind:class="currentPage === 'abilityPoints' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                        type="button" data-on:click="() => setPage('abilityPoints')">Ability Points</button>
                    <template data-if="isCaster">
                        <button
                            data-bind:class="currentPage === 'spells' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                            type="button" data-on:click="() => setPage('spells')">Spells</button>
                    </template>
                    <button
                        data-bind:class="currentPage === 'background' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                        type="button" data-on:click="() => setPage('background')">Background</button>
                    <button
                        data-bind:class="currentPage === 'appearance' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                        type="button" data-on:click="() => setPage('appearance')">Appearance</button>
                    <button data-bind:class="currentPage === 'summary' ? 'btn btn-primary' : 'btn btn-outline-primary'"
                        type="button" data-on:click="() => setPage('summary')">Summary</button>
                </div>
                <div class="dropdown editor-mobile-nav  align-self-end">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="editorDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Select page
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="editorDropdown">
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'race' }"
                                type="button" data-on:click="() => setPage('race')">Race</button></li>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'class' }"
                                type="button" data-on:click="() => setPage('class')">Class</button></li>
                        <li><button
                                data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'abilityPoints' }"
                                type="button" data-on:click="() => setPage('abilityPoints')">Ability Points</button>
                        </li>
                        <template data-if="isCaster">
                            <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'spells' }"
                                    type="button" data-on:click="() => setPage('spells')">Spells</button></li>
                        </template>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'background' }"
                                type="button" data-on:click="() => setPage('background')">Background</button></li>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'appearance' }"
                                type="button" data-on:click="() => setPage('appearance')">Appearance</button></li>
                        <li><button data-bind:class="{ 'dropdown-item': true, 'active': currentPage === 'summary' }"
                                type="button" data-on:click="() => setPage('summary')">Summary</button></li>
                </div>

                <!-- Markup for race selection -->
                <template data-if="currentPage === 'race'">
                    <div class="d-flex flex-column mt-4">
                        <div class="d-flex align-items-center align-self-start">
                            <label class="form-label text-nowrap me-2 mb-0" for="race-select">Choose a race:</label>
                            <select class="form-select" id="race-select" data-model="character.race"
                                data-on:change="resetStateOnRaceChange">
                                <template data-for="race in staticData.races">
                                    <option data-bind:value="race.id" data-text="race.name"
                                        data-bind:selected="character.race === race.id ? true : false">.</option>
                                </template>
                            </select>
                        </div>
                        <div class="row my-4">
                            <div class="col-12 col-md-8 col-lg-9">
                                <h1 data-text="chosenRace.name"></h1>
                                <p data-text="chosenRace.description"></p>
                            </div>
                            <div class="col-12 col-md-4 col-lg-3">
                                <span class="badge text-bg-dark me-1" data-text="`Size: ${chosenRace.size}`"></span>
                                <span class="badge text-bg-dark me-1"
                                    data-text="`Speed: ${chosenRace.speed} feet`"></span>
                                <template data-if="chosenRace.darkvision === true">
                                    <span class="badge text-bg-dark me-1">Darkvision</span>
                                </template>
                                <template
                                    data-for="abilityBonus in chosenRace.abilityBonuses.filter(abilityBonus => abilityBonus.bonus !== 0)">
                                    <span class="badge text-bg-dark me-1"
                                        data-text="`${abilityBonus.ability.name} +${abilityBonus.bonus}`"></span>
                                </template>
                                <template data-for="weapon in chosenRace.weaponProficiencies">
                                    <span class="badge text-bg-dark" data-text="`${weapon.name} proficiency`"></span>
                                </template>
                            </div>
                        </div>
                        <template data-if="chosenRace.additionalProperties.length > 0">
                            <div class="mb-4">
                                <h2 class="h4">Additional Properties</h2>
                                <div class="accordion" id="additional-race-properties">
                                    <template data-for="(property, index) in chosenRace.additionalProperties">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bind:data-bs-toggle="'collapse'"
                                                    data-bind:data-bs-target="'#collapse' + index" aria-expanded="false"
                                                    data-bind:aria-controls="'collapse' + index"
                                                    data-text="property.name">            
                                                </button>
                                            </h2>
                                            <div data-bind:id="'collapse' + index" class="accordion-collapse collapse"
                                                data-bind:data-bs-parent="'#additional-race-properties'">
                                                <div class="accordion-body" data-text="property.description"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>

                <!-- Markup for class selection -->
                <template data-if="currentPage === 'class'">
                    <div class="d-flex flex-column mt-4">

                        <div class="d-flex align-items-center align-self-start">
                            <label class="form-label text-nowrap me-2 mb-0" for="class-select">Choose a class:</label>
                            <select class="form-select" id="class-select" data-model="character.class" data-on:change="resetStateOnClassChange">
                                <template data-for="cls in staticData.classes">
                                    <option data-bind:value="cls.id" data-text="cls.name"
                                        data-bind:selected="character.class === cls.id ? true : false">.</option>
                                </template>
                            </select>
                        </div>

                        <div class="row my-4">
                            <div class="col-12 col-md-8 col-lg-9 mb-4">
                                <h1 data-text="chosenClass.name"></h1>
                                <span class="badge text-bg-dark" data-text="`Hit Die: ${chosenClass.hitDie}`"></span>
                                <p data-text="chosenClass.description"></p>
                            </div>

                            <div class="col-12 col-md-4 col-lg-3 mb-4">
                                <h2 class="h4">Skills</h2>
                                <p data-text="`Choose ${computedNumberOfSkillProficiencies} of the following skills to be proficient in:`"></p>
                                <ul class="list-group">
                                    <template data-for="skill in chosenClass.proficiencies.skills.from">
                                        <li class="list-group-item">
                                            <input type="checkbox" data-bind:id="skill.id" data-bind:checked="character.classSkillChoices.includes(skill.id)"
                                                data-on:change="toggleSkillProficiency(skill.id)"
                                                data-bind:disabled="Boolean(character.classSkillChoices.length >= computedNumberOfSkillProficiencies &&  !character.classSkillChoices.includes(skill.id))">
                                            <label data-bind:for="skill.id" data-text="skill.name"></label>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <div class="col-12 col-lg-9 mb-4">
                                <h3 class="h4">Proficiencies</h3>
                                <table class="table table-striped">
                                    <tbody>
                                        <tr data-show="chosenClass.proficiencies.armor.length > 0">
                                            <th class="align-middle">Armor Proficiencies</th>
                                            <td class="align-middle">
                                                <template data-for="armorType in chosenClass.proficiencies.armor">
                                                    <span class="badge text-bg-dark" data-text="armorType.name"></span>
                                                </template>
                                            </td>
                                        </tr>
                                        <tr data-show="chosenClass.proficiencies.weapons.length > 0">
                                            <th class="align-middle">Weapon Proficiencies</th>
                                            <td class="align-middle">
                                                <template data-for="weapon in chosenClass.proficiencies.weapons">
                                                    <span class="badge text-bg-dark" data-text="weapon.name"></span>
                                                </template>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="align-middle">Saving Throw Proficiencies</th>
                                            <td class="align-middle">
                                                <template data-for="savingThrow in chosenClass.proficiencies.savingThrows">
                                                    <span class="badge text-bg-dark" data-text="savingThrow.name"></span>
                                                </template>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-12 col-lg-3 mb-4">
                                <h4 class="h4">Equipment</h4>
                                <ul class="list-group">
                                    <template data-for="equipment in chosenClass.equipment">
                                        <li class="d-flex justify-content-between list-group-item">
                                            <span data-text="equipment.item.name"></span>
                                            <span class="badge text-bg-light" data-text="`Ã— ${equipment.quantity}`"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <template data-if="chosenRace.additionalProperties.length > 0">
                                <div class="mb-4">
                                    <h5 class="h4">Additional Properties</h5>
                                    <div class="accordion" id="additional-class-properties">
                                        <template data-for="(property, index) in chosenClass.additionalProperties">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bind:data-bs-toggle="'collapse'"
                                                        data-bind:data-bs-target="'#collapse' + index" aria-expanded="false"
                                                        data-bind:aria-controls="'collapse' + index"
                                                        data-text="property.name">            
                                                    </button>
                                                </h2>
                                                <div data-bind:id="'collapse' + index" class="accordion-collapse collapse"
                                                    data-bind:data-bs-parent="'#additional-class-properties'">
                                                    <div class="accordion-body" data-text="property.description"></div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                                
                        </div>

                    </div>
                </template>

                <!-- Markup for ability points selection -->
                <template data-if="currentPage === 'abilityPoints'">
                    <div>
                        <p>Here is where we explain about the standard array</p>
                        <p data-text="`Your primary ability is ${chosenClass.primaryAbility.name}`"></p>
                        <button type="button" data-on:click="resetAbilityPoints">Reset ability points</button>
                        <button type="button" data-on:click="setAbilityPointsToChosenClassDefaults">Use class
                            defaults</button>
                        <div>
                            <div>
                                <h3>Strength</h3>
                                <p data-text="`Total: ${getAdjustedAbilityScore('strength')}`"></p>
                                <p data-text="`Base: ${getAbilityBaseScore('strength')}`"></p>
                                <p data-text="`Race Bonus: ${getRacialAbilityBonus('strength')}`"></p>
                                <p data-text="`Modifier: ${getAbilityModifier('strength')}`"></p>
                            </div>
                            <div>
                                <h3>Dexterity</h3>
                                <p data-text="`Total: ${getAdjustedAbilityScore('dexterity')}`"></p>
                                <p data-text="`Base: ${getAbilityBaseScore('dexterity')}`"></p>
                                <p data-text="`Race Bonus: ${getRacialAbilityBonus('dexterity')}`"></p>
                                <p data-text="`Modifier: ${getAbilityModifier('dexterity')}`"></p>
                            </div>
                            <div>
                                <h3>Constitution</h3>
                                <p data-text="`Total: ${getAdjustedAbilityScore('constitution')}`"></p>
                                <p data-text="`Base: ${getAbilityBaseScore('constitution')}`"></p>
                                <p data-text="`Race Bonus: ${getRacialAbilityBonus('constitution')}`"></p>
                                <p data-text="`Modifier: ${getAbilityModifier('constitution')}`"></p>
                            </div>
                            <div>
                                <h3>Intelligence</h3>
                                <p data-text="`Total: ${getAdjustedAbilityScore('intelligence')}`"></p>
                                <p data-text="`Base: ${getAbilityBaseScore('intelligence')}`"></p>
                                <p data-text="`Race Bonus: ${getRacialAbilityBonus('intelligence')}`"></p>
                                <p data-text="`Modifier: ${getAbilityModifier('intelligence')}`"></p>
                            </div>
                            <div>
                                <h3>Wisdom</h3>
                                <p data-text="`Total: ${getAdjustedAbilityScore('wisdom')}`"></p>
                                <p data-text="`Base: ${getAbilityBaseScore('wisdom')}`"></p>
                                <p data-text="`Race Bonus: ${getRacialAbilityBonus('wisdom')}`"></p>
                                <p data-text="`Modifier: ${getAbilityModifier('wisdom')}`"></p>
                            </div>
                            <div>
                                <h3>Charisma</h3>
                                <p data-text="`Total: ${getAdjustedAbilityScore('charisma')}`"></p>
                                <p data-text="`Base: ${getAbilityBaseScore('charisma')}`"></p>
                                <p data-text="`Race Bonus: ${getRacialAbilityBonus('charisma')}`"></p>
                                <p data-text="`Modifier: ${getAbilityModifier('charisma')}`"></p>
                            </div>
                        </div>


                        <!-- Strength points select -->
                        <div>
                            <label for="strength-points-select">Strength:</label>
                            <select id="strength-points-select" data-model.number="character.abilityPoints[0].value">
                                <template
                                    data-for="pointOption in computeAbilityPointOptions('0caab33e-f424-4a44-94cd-0c6951e5bdfe')">
                                    <option data-bind:value="pointOption"
                                        data-bind:selected="character.abilityPoints[0].value === pointOption ? true : false"
                                        data-text="pointOption">
                                    </option>
                                </template>
                            </select>
                            <p data-text="getAbilityData('0caab33e-f424-4a44-94cd-0c6951e5bdfe').description"></p>
                        </div>
                        <!-- Dexterity points select -->
                        <div>
                            <label for="dexterity-points-select">Dexterity:</label>
                            <select id="dexterity-points-select" data-model.number="character.abilityPoints[1].value">
                                <template
                                    data-for="pointOption in computeAbilityPointOptions('fd107c7f-4536-4b36-bf43-e49d92a3c4c2')">
                                    <option data-bind:value="pointOption"
                                        data-bind:selected="character.abilityPoints[1].value === pointOption ? true : false"
                                        data-text="pointOption">
                                    </option>
                                </template>
                            </select>
                            <p data-text="getAbilityData('fd107c7f-4536-4b36-bf43-e49d92a3c4c2').description"></p>
                        </div>
                        <!-- Constitution points select -->
                        <div>
                            <label for="constitution-points-select">Constitution:</label>
                            <select id="constitution-points-select"
                                data-model.number="character.abilityPoints[2].value">
                                <template
                                    data-for="pointOption in computeAbilityPointOptions('b9b14f85-78db-49ea-b07b-b8bdd7a40046')">
                                    <option data-bind:value="pointOption"
                                        data-bind:selected="character.abilityPoints[2].value === pointOption ? true : false"
                                        data-text="pointOption">
                                    </option>
                                </template>
                            </select>
                            <p data-text="getAbilityData('b9b14f85-78db-49ea-b07b-b8bdd7a40046').description"></p>
                        </div>
                        <!-- Intelligence points select -->
                        <div>
                            <label for="intelligence-points-select">Intelligence:</label>
                            <select id="intelligence-points-select"
                                data-model.number="character.abilityPoints[3].value">
                                <template
                                    data-for="pointOption in computeAbilityPointOptions('44fbcb3c-d548-4a3c-aa85-4c55e05aabed')">
                                    <option data-bind:value="pointOption"
                                        data-bind:selected="character.abilityPoints[3].value === pointOption ? true : false"
                                        data-text="pointOption">
                                    </option>
                                </template>
                            </select>
                            <p data-text="getAbilityData('44fbcb3c-d548-4a3c-aa85-4c55e05aabed').description"></p>
                        </div>
                        <!-- Wisdom points select -->
                        <div>
                            <label for="wisdom-points-select">Wisdom:</label>
                            <select id="wisdom-points-select" data-model.number="character.abilityPoints[4].value">
                                <template
                                    data-for="pointOption in computeAbilityPointOptions('468b3218-340b-4263-9450-dc72e6750f16')">
                                    <option data-bind:value="pointOption"
                                        data-bind:selected="character.abilityPoints[4].value === pointOption ? true : false"
                                        data-text="pointOption">
                                    </option>
                                </template>
                            </select>
                            <p data-text="getAbilityData('468b3218-340b-4263-9450-dc72e6750f16').description"></p>
                        </div>
                        <!-- Charisma points select -->
                        <div>
                            <label for="charisma-points-select">Charisma:</label>
                            <select id="charisma-points-select" data-model.number="character.abilityPoints[5].value">
                                <template
                                    data-for="pointOption in computeAbilityPointOptions('b15c2aa9-87e7-408d-89a7-3bbd64d981a9')">
                                    <option data-bind:value="pointOption"
                                        data-bind:selected="character.abilityPoints[5].value === pointOption ? true : false"
                                        data-text="pointOption">
                                    </option>
                                </template>
                            </select>
                            <p data-text="getAbilityData('b15c2aa9-87e7-408d-89a7-3bbd64d981a9').description"></p>
                        </div>
                    </div>
                </template>

                <!-- Markup for spells selection -->
                <template data-if="currentPage === 'spells'">
                    <div>
                        <div>
                            <h3
                                data-text="`${character.classCantripChoices.length} of ${chosenClass.spellcasting.cantrips.choose} cantrips chosen`">
                            </h3>
                            <template data-if="character.classCantripChoices.length > 0">
                                <ul>
                                    <template data-for="cantripId in character.classCantripChoices">
                                        <li>
                                            <span data-text="getCantripData(cantripId).name"></span>
                                            <button type="button"
                                                data-on:click="removeCantrip(cantripId)">Remove</button>
                                        </li>
                                    </template>
                                </ul>
                            </template>
                            <h3
                                data-text="`${character.classSpellChoices.length} of ${chosenClass.spellcasting.spells.choose} spells chosen`">
                            </h3>
                            <template data-if="character.classSpellChoices.length > 0">
                                <ul>
                                    <template data-for="spellId in character.classSpellChoices">
                                        <li>
                                            <span data-text="getSpellData(spellId).name"></span>
                                            <button type="button" data-on:click="removeSpell(spellId)">Remove</button>
                                        </li>
                                    </template>
                                </ul>
                            </template>
                        </div>
                        <h3>Cantrips</h3>
                        <ul>
                            <template data-for="cantrip in chosenClass.spellcasting.cantrips.from">
                                <li data-data="{ open: false }">
                                    <h5 data-text="cantrip.name"></h5>
                                    <span data-text="cantrip.school"></span>
                                    <template data-if="open">
                                        <div>
                                            <p data-html="formatLineBreaks(cantrip.description)"></p>
                                            <p data-text="`Range: ${cantrip.range}`"></p>
                                            <p data-text="`Casting time: ${cantrip.castingTime}`"></p>
                                            <p data-text="`Duration: ${cantrip.duration}`"></p>
                                            <p
                                                data-text="cantrip.concentration ? 'Requires concentration' : 'Does not require concentration' ">
                                            </p>
                                            <button type="button" data-on:click="() => open = false">See less</button>
                                        </div>
                                    </template>
                                    <template data-if="!open">
                                        <div>
                                            <p data-html="formatLineBreaks(truncateText(cantrip.description, 200))"></p>
                                            <button type="button" data-on:click="() => open = true">See more</button>
                                        </div>
                                    </template>
                                    <template data-if="character.classCantripChoices.includes(cantrip.id)">
                                        <button type="button" data-on:click="() => removeCantrip(cantrip.id)">Remove
                                            Cantrip</button>
                                    </template>
                                    <template data-if="!character.classCantripChoices.includes(cantrip.id)">
                                        <button type="button"
                                            data-bind:disabled="character.classCantripChoices.length >= chosenClass.spellcasting.cantrips.choose"
                                            data-on:click="() => addCantrip(cantrip.id)">
                                            Add Cantrip
                                        </button>
                                    </template>
                                </li>
                            </template>
                        </ul>
                        <h3>Spells</h3>
                        <ul>
                            <template data-for="spell in chosenClass.spellcasting.spells.from">
                                <li data-data="{ open: false }">
                                    <h5 data-text="spell.name"></h5>
                                    <span data-text="spell.school"></span>
                                    <template data-if="open">
                                        <div>
                                            <p data-html="formatLineBreaks(spell.description)"></p>
                                            <p data-text="`Range: ${spell.range}`"></p>
                                            <p data-text="`Casting time: ${spell.castingTime}`"></p>
                                            <p data-text="`Duration: ${spell.duration}`"></p>
                                            <p
                                                data-text="spell.concentration ? 'Requires concentration' : 'Does not require concentration' ">
                                            </p>
                                            <button type="button" data-on:click="() => open = false">See less</button>
                                        </div>
                                    </template>
                                    <template data-if="!open">
                                        <div>
                                            <p data-html="formatLineBreaks(truncateText(spell.description, 200))"></p>
                                            <button type="button" data-on:click="() => open = true">See more</button>
                                        </div>
                                    </template>
                                    <template data-if="character.classSpellChoices.includes(spell.id)">
                                        <button type="button" data-on:click="() => removeSpell(spell.id)">Remove
                                            Spell</button>
                                    </template>
                                    <template data-if="!character.classSpellChoices.includes(spell.id)">
                                        <button type="button"
                                            data-bind:disabled="character.classSpellChoices.length >= chosenClass.spellcasting.spells.choose"
                                            data-on:click="() => addSpell(spell.id)">
                                            Add Spell
                                        </button>
                                    </template>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>


                <!-- Markup for background selection -->
                <template data-if="currentPage === 'background'">
                    <div>
                        <label for="character-name">Name:</label>
                        <input id="character-name" type="text" data-model="character.name" placeholder="Enter name" />
                        <label for="character-age">Age:</label>
                        <input id="character-age" type="number" min="0" data-model="character.age" />
                        <label for="character-gender">Gender</label>
                        <input id="character-gender" type="text" data-model="character.gender"
                            placeholder="Choose gender" />
                        <label for="character-alignment">Alignment</label>
                        <select id="character-alignment" data-model="character.alignment">
                            <option value="Lawful Good"
                                data-bind:selected="character.alignment === 'Lawful Good' ? true : false">Lawful Good
                            </option>
                            <option value="Neutral Good"
                                data-bind:selected="character.alignment === 'Neutral Good' ? true : false">Neutral Good
                            </option>
                            <option value="Chaotic Good"
                                data-bind:selected="character.alignment === 'Chaotic Good' ? true : false">Chaotic Good
                            </option>
                            <option value="Lawful Neutral"
                                data-bind:selected="character.alignment === 'Lawful Neutral' ? true : false">Lawful
                                Neutral</option>
                            <option value="True Neutral"
                                data-bind:selected="character.alignment === 'True Neutral' ? true : false">True Neutral
                            </option>
                            <option value="Chaotic Neutral"
                                data-bind:selected="character.alignment === 'Chaotic Neutral' ? true : false">Chaotic
                                Neutral</option>
                            <option value="Lawful Evil"
                                data-bind:selected="character.alignment === 'Lawful Evil' ? true : false">Lawful Evil
                            </option>
                            <option value="Neutral Evil"
                                data-bind:selected="character.alignment === 'Neutral Evil' ? true : false">Neutral Evil
                            </option>
                            <option value="Chaotic Evil"
                                data-bind:selected="character.alignment === 'Chaotic Evil' ? true : false">Chaotic Evil
                            </option>
                        </select>
                        <label for="character-background">Background</label>
                        <textarea id="character-background" data-model="character.background"
                            placeholder="Enter background"></textarea>

                        <!-- Traits -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-traits">Traits</label>
                                <input id="character-traits" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.traits.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.traits.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(trait, index) in character.traits">
                                    <li data-bind:key="trait">
                                        <span data-text="trait"></span>
                                        <button type="button"
                                            data-on:click="() => character.traits.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                        <!-- Ideals -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-ideals">Ideals</label>
                                <input id="character-ideals" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.ideals.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.ideals.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(ideal, index) in character.ideals">
                                    <li data-bind:key="ideal">
                                        <span data-text="ideal"></span>
                                        <button type="button"
                                            data-on:click="() => character.ideals.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                        <!-- Bonds -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-bonds">Bonds</label>
                                <input id="character-bonds" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.bonds.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.bonds.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(bond, index) in character.bonds">
                                    <li data-bind:key="bond">
                                        <span data-text="bond"></span>
                                        <button type="button"
                                            data-on:click="() => character.bonds.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                        <!-- Flaws -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-flaws">Flaws</label>
                                <input id="character-flaws" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.flaws.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.flaws.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(flaw, index) in character.flaws">
                                    <li data-bind:key="flaw">
                                        <span data-text="flaw"></span>
                                        <button type="button"
                                            data-on:click="() => character.flaws.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                    </div>
                </template>

                <!-- Markup for appearance selection -->
                <template data-if="currentPage === 'appearance'">
                    <div>
                        <!-- Height -->
                        <label for="character-height">Height:</label>
                        <input id="character-height" type="text" data-model="character.height" />
                        <!-- Build -->
                        <label for="character-build">Build:</label>
                        <input id="character-build" type="text" data-model="character.build" />
                        <!-- Skin tone -->
                        <label for="character-skin-tone">Skin Tone:</label>
                        <input id="character-skin-tone" type="text" data-model="character.skinTone" />
                        <!-- Hair color -->
                        <label for="character-hair-color">Hair Color:</label>
                        <input id="character-hair-color" type="text" data-model="character.hairColor" />
                        <!-- Hair style -->
                        <label for="character-hair-style">Hair Style:</label>
                        <input id="character-hair-style" type="text" data-model="character.hairStyle" />
                        <!-- Hair length dropdown -->
                        <label for="character-hair-length">Hair Length:</label>
                        <select data-data="{ options: ['Bald', 'Cropped', 'Short', 'Medium', 'Long', 'Rapunzel'] }"
                            data-model="character.hairLength" id="character-hair-length">
                            <template data-for="option in options">
                                <option data-bind:value="option"
                                    data-bind:selected="character.hairLength === option ? true : false"
                                    data-text="option"></option>
                            </template>
                        </select>
                        <!-- Hair type dropdown -->
                        <label for="character-hair-type">Hair Type:</label>
                        <select data-data="{ options: ['Straight', 'Wavy', 'Curly', 'Snakes'] }"
                            data-model="character.hairType" id="character-hair-type">
                            <template data-for="option in options">
                                <option data-bind:value="option"
                                    data-bind:selected="character.hairType === option ? true : false"
                                    data-text="option"></option>
                            </template>
                        </select>
                        <!-- Facial hair style dropdown -->
                        <label for="character-facial-hair-style">Facial Hair Style:</label>
                        <select
                            data-data="{ options: ['None', 'Stubble', 'Full Beard', 'Goatee', 'Mustache', 'Sideburns', 'Soul Patch', 'Mutton Chops'] }"
                            data-model="character.facialHairStyle" id="character-facial-hair-style">
                            <template data-for="option in options">
                                <option data-bind:value="option"
                                    data-bind:selected="character.facialHairStyle === option ? true : false"
                                    data-text="option"></option>
                            </template>
                        </select>
                        <!-- Facial hair length dropdown -->
                        <label for="character-facial-hair-length">Facial Hair Length:</label>
                        <select data-data="{ options: ['Short', 'Medium', 'Long'] }"
                            data-model="character.facialHairLength" id="character-facial-hair-length">
                            <template data-for="option in options">
                                <option data-bind:value="option"
                                    data-bind:selected="character.facialHairLength === option ? true : false"
                                    data-text="option"></option>
                            </template>
                        </select>
                        <!-- Eye Color -->
                        <label for="character-eye-color">Eye Color:</label>
                        <input id="character-eye-color" type="text" data-model="character.eyeColor" />
                        <!-- Eye shape dropdown -->
                        <label for="character-eye-shape">Eye Shape:</label>
                        <select data-data="{ options: ['Almond', 'Round', 'Narrow', 'Wide'] }"
                            data-model="character.eyeShape" id="character-eye-shape">
                            <template data-for="option in options">
                                <option data-bind:value="option"
                                    data-bind:selected="character.eyeShape === option ? true : false"
                                    data-text="option"></option>
                            </template>
                        </select>

                        <!-- Distinguishing features -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-distinguishing-features">Distinguishing Features:</label>
                                <input id="character-distinguishing-features" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.distinguishingFeatures.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.distinguishingFeatures.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(feature, index) in character.distinguishingFeatures">
                                    <li data-bind:key="feature">
                                        <span data-text="feature"></span>
                                        <button type="button"
                                            data-on:click="() => character.distinguishingFeatures.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                        <!-- Clothing style -->
                        <label for="character-clothing-style">Clothing Style:</label>
                        <input id="character-clothing-style" type="text" data-model="character.clothingStyle" />

                        <!-- Clothing colors -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-clothing-colors">Clothing Colors:</label>
                                <input id="character-clothing-colors" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.clothingColors.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.clothingColors.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(clothingColor, index) in character.clothingColors">
                                    <li data-bind:key="clothingColor">
                                        <span data-text="clothingColor"></span>
                                        <button type="button"
                                            data-on:click="() => character.clothingColors.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                        <!-- Clothing accessories -->
                        <div data-data="{ temp: '', clear() { this.temp = '' } }">
                            <div>
                                <label for="character-clothing-accessories">Clothing Accessories:</label>
                                <input id="character-clothing-accessories" type="text" data-model="temp"
                                    data-on:keydown.enter="() => { character.clothingAccessories.push(temp); clear() }" />
                                <button type="button"
                                    data-on:click="() => { character.clothingAccessories.push(temp); clear() }">Add</button>
                            </div>
                            <ul>
                                <template data-for="(accessory, index) in character.clothingAccessories">
                                    <li data-bind:key="accessory">
                                        <span data-text="accessory"></span>
                                        <button type="button"
                                            data-on:click="() => character.clothingAccessories.splice(index, 1)">Remove</button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                    </div>
                </template>

                <!-- Markup for summary -->
                <template data-if="currentPage === 'summary'">
                    <button type="submit" data-on:click="handleSubmit">Save</button>
                </template>
            </div>
        </template>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script type="module" src="{% static 'js/main.js' %}"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}